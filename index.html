<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="Status updates for the UCF Materia application">
	<title>Materia Status</title>
	<link rel="stylesheet" href="styles.css" />
</head>
<body>
	<div class="container">
		<header>
			<h1>Materia Status</h1>
			<p>Current status and updates for the UCF Materia application</p>
		</header>

		<div class="status-banner" id="mainStatus">
			<div class="status-indicator">
				<div class="status-dot" id="statusDot"></div>
				<h2 class="status-title" id="statusTitle">All Systems Operational</h2>
			</div>
			<p class="status-description" id="statusDescription">All services are running normally.</p>
		</div>

		<div class="services-section">
			<h2>Service Status</h2>
			<div id="servicesList">
				<!-- Services will be loaded here -->
			</div>
		</div>

		<div class="incidents-section">
			<h2>Recent Incidents</h2>
			<div id="incidentsList">
				<p class="no-incidents">No recent incidents to report.</p>
			</div>
		</div>

		<div class="last-updated" id="lastUpdated">
			Last updated: <span id="updateTime">Loading...</span>
		</div>

		<footer>
			<p>
				Materia Status Page | 
				<a href="https://github.com/ucfopen/Materia" target="_blank">Materia on GitHub</a> | 
				<a href="https://ucfopen.github.io/Materia-Docs/" target="_blank">Documentation</a>
			</p>
		</footer>
	</div>

	<script>
		// Default status data configuration (fallback if status.json is not available)
		let statusData = {
			overallStatus: 'operational', // operational, degraded, outage, maintenance
			services: [
				{ name: 'Web Application', status: 'operational' },
				{ name: 'Widget Engine', status: 'operational' },
				{ name: 'API Services', status: 'operational' },
				{ name: 'Database', status: 'operational' },
				{ name: 'Authentication', status: 'operational' }
			],
			incidents: [
				// Example incident structure (currently empty for operational status)
				// {
				//     title: 'Example Incident',
				//     status: 'resolved', // resolved, investigating, monitoring, critical
				//     date: '2025-11-30 14:30 UTC',
				//     description: 'Brief description of the incident and resolution.'
				// }
			]
		};

		// Status messages
		const statusMessages = {
			operational: {
				title: 'All Systems Operational',
				description: 'All services are running normally.'
			},
			degraded: {
				title: 'Degraded Performance',
				description: 'Some services are experiencing degraded performance.'
			},
			outage: {
				title: 'Service Outage',
				description: 'One or more services are currently unavailable.'
			},
			maintenance: {
				title: 'Scheduled Maintenance',
				description: 'Planned maintenance is in progress.'
			}
		};

		// Status text labels
		const statusLabels = {
			operational: 'Operational',
			degraded: 'Degraded',
			outage: 'Outage'
		};

		// Load status data from external JSON file
		async function loadStatusData() {
			try {
				const response = await fetch('status.json');
				if (response.ok) {
					const data = await response.json();
					statusData = data;
					console.log('Status data loaded from status.json');
				} else {
					console.log('Could not load status.json, using default data');
				}
			} catch (error) {
				console.log('Could not load status.json, using default data:', error.message);
			}
		}

		// Initialize the page
		async function init() {
			await loadStatusData();
			updateOverallStatus();
			renderServices();
			renderIncidents();
			updateTimestamp();
		}

		// Update overall status banner
		function updateOverallStatus() {
			const banner = document.getElementById('mainStatus');
			const dot = document.getElementById('statusDot');
			const title = document.getElementById('statusTitle');
			const description = document.getElementById('statusDescription');

			const status = statusData.overallStatus;
			const message = statusMessages[status];

			// Update classes
			banner.className = 'status-banner ' + status;
			dot.className = 'status-dot ' + status;

			// Update text
			title.textContent = message.title;
			description.textContent = message.description;
		}

		// Render services list
		function renderServices() {
			const servicesList = document.getElementById('servicesList');
			servicesList.innerHTML = '';

			statusData.services.forEach(service => {
				const serviceItem = document.createElement('div');
				serviceItem.className = 'service-item';

				const serviceName = document.createElement('span');
				serviceName.className = 'service-name';
				serviceName.textContent = service.name;

				const serviceStatus = document.createElement('div');
				serviceStatus.className = 'service-status';

				const statusDot = document.createElement('span');
				statusDot.className = 'service-status-dot ' + service.status;

				const statusText = document.createElement('span');
				statusText.textContent = statusLabels[service.status] || service.status;

				serviceStatus.appendChild(statusDot);
				serviceStatus.appendChild(statusText);

				serviceItem.appendChild(serviceName);
				serviceItem.appendChild(serviceStatus);

				servicesList.appendChild(serviceItem);
			});
		}

		// Render incidents list
		function renderIncidents() {
			const incidentsList = document.getElementById('incidentsList');

			if (statusData.incidents.length === 0) {
				incidentsList.innerHTML = '<p class="no-incidents">No recent incidents to report.</p>';
				return;
			}

			incidentsList.innerHTML = '';

			statusData.incidents.forEach(incident => {
				const incidentDiv = document.createElement('div');
				incidentDiv.className = 'incident ' + incident.status;

				const header = document.createElement('div');
				header.className = 'incident-header';

				const title = document.createElement('div');
				title.className = 'incident-title';
				title.textContent = incident.title;

				const status = document.createElement('span');
				status.className = 'incident-status ' + incident.status;
				status.textContent = incident.status.charAt(0).toUpperCase() + incident.status.slice(1);

				header.appendChild(title);
				header.appendChild(status);

				const date = document.createElement('div');
				date.className = 'incident-date';
				date.textContent = incident.date;

				const description = document.createElement('p');
				description.className = 'incident-description';
				description.textContent = incident.description;

				incidentDiv.appendChild(header);
				incidentDiv.appendChild(date);
				incidentDiv.appendChild(description);

				incidentsList.appendChild(incidentDiv);
			});
		}

		// Update timestamp
		function updateTimestamp() {
			const updateTime = document.getElementById('updateTime');
			const now = new Date();
			updateTime.textContent = now.toLocaleString('en-US', {
				year: 'numeric',
				month: 'long',
				day: 'numeric',
				hour: '2-digit',
				minute: '2-digit',
				timeZoneName: 'short'
			});
		}

		// Initialize on page load
		document.addEventListener('DOMContentLoaded', init);

		// Auto-refresh every 5 minutes to check for status updates
		setInterval(async () => {
			await loadStatusData();
			updateOverallStatus();
			renderServices();
			renderIncidents();
			updateTimestamp();
		}, 300000);
	</script>
</body>
</html>
